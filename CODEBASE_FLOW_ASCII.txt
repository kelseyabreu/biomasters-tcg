ğŸ§¬ BioMasters TCG - Codebase Architecture & Flow (ASCII)
================================================================

ğŸ“¦ MONOREPO STRUCTURE
=====================

biomasters-tcg/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ ğŸ”§ shared/           â† @kelseyabreu/shared (npm workspace)
â”‚   â”‚   â”œâ”€â”€ types.ts         â† TypeScript interfaces
â”‚   â”‚   â”œâ”€â”€ enums.ts         â† Game constants (CardId, TrophicLevel)
â”‚   â”‚   â”œâ”€â”€ game-engine/     â† Unified game system
â”‚   â”‚   â”‚   â”œâ”€â”€ TCGEngine.ts      â† Multiplayer mode
â”‚   â”‚   â”‚   â”œâ”€â”€ PhyloEngine.ts    â† Campaign mode  
â”‚   â”‚   â”‚   â””â”€â”€ BioMastersEngine.ts â† Core rules
â”‚   â”‚   â””â”€â”€ data/            â† Cross-platform data loading
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸš€ server/           â† Node.js + Express API
â”‚   â”‚   â”œâ”€â”€ routes/          â† HTTP endpoints
â”‚   â”‚   â”œâ”€â”€ websocket/       â† Real-time communication
â”‚   â”‚   â”œâ”€â”€ services/        â† Game workers & matchmaking
â”‚   â”‚   â””â”€â”€ config/          â† DB, Redis, Firebase setup
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“± frontend/         â† React + Ionic (src/)
â”‚       â”œâ”€â”€ App.tsx          â† Main React app
â”‚       â”œâ”€â”€ state/           â† Zustand + React Query
â”‚       â”œâ”€â”€ services/        â† Game logic & API clients
â”‚       â””â”€â”€ components/      â† UI components
â”‚
â”œâ”€â”€ ğŸ“Š public/data/          â† Single source of truth
â”‚   â”œâ”€â”€ cards.json           â† All card data
â”‚   â”œâ”€â”€ abilities.json       â† Ability definitions
â”‚   â””â”€â”€ localization/en.json â† Text content
â”‚
â””â”€â”€ ğŸ“‹ package.json          â† Workspace configuration

ğŸŒŠ DATA FLOW
============

1. JSON Data Loading:
   ğŸ“„ /public/data/*.json
        â†“
   ğŸ“Š UnifiedDataLoader (environment detection)
        â†“
   ğŸ® Game Engines (TCG/Phylo)

2. Frontend Flow:
   âš›ï¸ React App
        â†“
   ğŸ—„ï¸ Hybrid Store (Zustand)
        â†“
   ğŸ® Game Services
        â†“
   ğŸ”„ Unified Game Service
        â†“
   ğŸƒ TCG Engine / ğŸŒ± Phylo Engine

3. Backend Flow:
   ğŸŒ Express API / âš¡ WebSocket
        â†“
   ğŸ‘¥ Game Workers
        â†“
   ğŸ§¬ BioMasters Core Engine
        â†“
   ğŸ”´ Redis (state) + ğŸ˜ PostgreSQL (persistence)

ğŸ”„ COMMUNICATION PATTERNS
=========================

Frontend â†â†’ Backend:
ğŸ“± React App â”€â”€HTTP/WSâ”€â”€â–º ğŸš€ Express Server
     â”‚                         â”‚
     â”œâ”€â”€ ğŸ” Firebase Auth â”€â”€â”€â”€â”€â”€â”¤
     â”œâ”€â”€ ğŸ“Š Static Data â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â””â”€â”€ ğŸ® Game Actions â”€â”€â”€â”€â”€â”€â”€â”¤
                               â”‚
                               â–¼
                        ğŸ§¬ Game Engine
                               â”‚
                               â–¼
                    ğŸ”´ Redis â†â†’ ğŸ˜ PostgreSQL

Offline Mode:
ğŸ“± Frontend â”€â”€â–º ğŸ“„ Local JSON â”€â”€â–º ğŸ® Local Engine

Online Mode:
ğŸ“± Frontend â”€â”€â–º ğŸš€ Server â”€â”€â–º ğŸ§¬ Authoritative Engine

ğŸ—ï¸ KEY ARCHITECTURAL PATTERNS
==============================

1. ğŸ“¦ Monorepo with npm workspaces
   - Shared package for common code
   - Type-safe imports across packages
   - Single build system

2. ğŸ® Unified Game Engine
   - Abstract interface (IGameEngine)
   - Multiple implementations (TCG/Phylo)
   - Factory pattern for creation
   - Environment-aware data loading

3. ğŸ”„ Offline-First Design
   - Local JSON data as fallback
   - Progressive enhancement
   - Sync service for conflict resolution

4. âš¡ Real-time Features
   - WebSocket for live gameplay
   - Redis for session state
   - Pub/Sub for scaling

5. ğŸŒ Cross-Platform Support
   - React + Ionic for web/mobile
   - Capacitor for native features
   - PWA capabilities

â˜ï¸ EXTERNAL SERVICES
====================

ğŸ”¥ Firebase:
   - Authentication (Google, email, anonymous)
   - User management
   - JWT tokens

ğŸš‚ Railway:
   - PostgreSQL database
   - Production hosting

â˜ï¸ Google Cloud Platform:
   - ğŸ”´ Redis Memorystore (session cache)
   - ğŸ“¡ Cloud Pub/Sub (messaging)
   - ğŸ” Service account authentication
   - ğŸ–¥ï¸ Compute VM (development access)

ğŸ§ª DEVELOPMENT SETUP
====================

Local Development:
1. Frontend: localhost:5173 (Vite)
2. Backend: localhost:3001 (Express)
3. Redis: SSH tunnel to GCP
4. Database: Railway PostgreSQL
5. Auth: Firebase

Production:
1. Frontend: CDN/hosting
2. Backend: Cloud deployment
3. Redis: Direct GCP connection
4. Database: Railway PostgreSQL
5. Scaling: Cloud Pub/Sub

ğŸ¯ GAME MODES
=============

ğŸƒ TCG Mode (Multiplayer):
   - Real-time card battles
   - Authoritative server validation
   - WebSocket communication
   - Redis session management

ğŸŒ± Phylo Mode (Campaign):
   - Single-player progression
   - Local state management
   - Offline-capable
   - Educational content

ğŸ”„ Hybrid Store:
   - Seamless mode switching
   - Unified state management
   - Sync between local/server

ğŸ“Š DATA ARCHITECTURE
====================

Single Source of Truth:
ğŸ“„ /public/data/*.json files contain all game data

Environment Detection:
ğŸŒ Client (browser) â†’ Fetch API
ğŸ“± Mobile (Capacitor) â†’ Native file access  
ğŸš€ Server (Node.js) â†’ Filesystem
ğŸ§ª Test â†’ No caching

Cross-Platform Compatibility:
- Browser-safe process checks
- Environment-specific loaders
- Graceful fallbacks

ğŸ” SECURITY MODEL
=================

Authentication:
- Firebase Auth integration
- Guest user support
- JWT token management

Authorization:
- Role-based access control
- Server-side validation
- Secure API endpoints

Data Protection:
- Encrypted connections (HTTPS/WSS)
- Input validation
- SQL injection prevention (Kysely)

ğŸš€ DEPLOYMENT STRATEGY
======================

Development:
- Local development servers
- SSH tunnels for cloud services
- Hot reload for rapid iteration

Production:
- Container deployment
- Load balancing
- Auto-scaling with Pub/Sub
- CDN for static assets

Monitoring:
- Health check endpoints
- Error logging
- Performance metrics
